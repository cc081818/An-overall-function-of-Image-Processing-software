function th=thresh_md(a)
%????????????????
%???????????????????                 
count=imhist(a);
%??????a???????????     
[m,n]=size(a);
N=m*n-sum(sum(find(a==0),1));
L=256;   
%????????0?????            
count=count/N;
for i=2:L
  if count(i)~=0
    st=i-1;
    break;
  end
end
%????????0?????
for i=L:-1:1
  if count(i)~=0
    nd=i-1;
    break;
  end
end
f=count(st+1:nd+1);
%p?q???????????
p=st;q=nd-st;
u=0;
for i=1:q
  u=u+f(i)*(p+i-1);
  ua(i)=u;
end
%???????k???A?????
for i=1:q
  w(i)=sum(f(1:i));
end
%????k???????
d=(u*w-ua).^2./(w.*(1-w));
%????????????
[y,tp]=max(d);
th=tp+p;


